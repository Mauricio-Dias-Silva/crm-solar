{% extends 'base.html' %}

{% block title %}Editar Cliente{% endblock %}

{% block content %}
    <div class="container mt-5">
        <h2>Editar Cliente: {{ cliente.nome }}</h2>

        {% if form.errors %}
            <div class="alert alert-danger">
                <ul>
                    {% for field in form %}
                        {% for error in field.errors %}
                            <li><strong>{{ field.label }}:</strong> {{ error }}</li>
                        {% endfor %}
                    {% endfor %}
                </ul>
            </div>
        {% endif %}

        <form method="POST" id="form_cliente">
            {% csrf_token %}
            
            <div class="form-group">
                <label for="{{ form.nome.id_for_label }}">Nome do Cliente</label>
                {{ form.nome }}
            </div>

            <div class="form-group">
                <label for="{{ form.email.id_for_label }}">E-mail</label>
                {{ form.email }}
            </div>

            <div class="form-group">
                <label for="{{ form.cnpj.id_for_label }}">CNPJ</label>
                {{ form.cnpj }}
            </div>

            <div class="form-group">
                <label for="{{ form.endereco.id_for_label }}">Endereço</label>
                {{ form.endereco }}
            </div>

            <div class="form-group">
                <label for="{{ form.telefone.id_for_label }}">Telefone</label>
                {{ form.telefone }}
            </div>

            <div class="form-group">
                <label for="{{ form.id_acesso.id_for_label }}">ID de Acesso</label>
                {{ form.id_acesso }}
            </div>

            <div class="form-group">
                <label for="{{ form.senha_acesso_plano.id_for_label }}">Nova Senha de Acesso</label>
                {{ form.senha_acesso_plano }}
                <small class="form-text text-muted">
                    Deixe em branco se não quiser alterar a senha.
                </small>
            </div>

            <button type="submit" class="btn btn-primary">Salvar Alterações</button>
        </form>

        <a href="{% url 'lista_clientes' %}" class="btn btn-secondary mt-3">Voltar</a>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const cnpjInput = document.getElementById("id_cnpj");
            const form = document.getElementById("form_cliente");

            if (cnpjInput) {
                cnpjInput.setAttribute('maxlength', '18');

                cnpjInput.addEventListener("input", function () {
                    let value = cnpjInput.value.replace(/\D/g, '');
                    value = value.slice(0, 14);

                    let formatted = value.replace(/^(\d{0,2})(\d{0,3})(\d{0,3})(\d{0,4})(\d{0,2})/, function(_, a, b, c, d, e) {
                        let result = '';
                        if (a) result += a;
                        if (b) result += '.' + b;
                        if (c) result += '.' + c;
                        if (d) result += '/' + d;
                        if (e) result += '-' + e;
                        return result;
                    });

                    cnpjInput.value = formatted;
                });

                form.addEventListener("submit", function () {
                    cnpjInput.value = cnpjInput.value.replace(/\D/g, '');
                });
            }
        });
    </script>
{% endblock %}
